sudo: required

services:
   - docker	
   
env:
  global:
    - REGISTRY: registry.blackwoodseven.com
    - IMAGENAME: $REGISTRY/$TRAVIS_REPO_SLUG
    - TAG_VERSION: $TRAVIS_BRANCH.$TRAVIS_BUILD_NUMBER
    - TAG_LATEST: latest
	
script:
  - docker-machine -v
  - docker-compose -v
  - echo $DOCKER_HOST
  - echo $DOCKER_CERT_PATH
  - docker login -e="tech@blackwoodseven.com" -u="bw7" -p="iron73?Morse" $REGISTRY
  - echo "LABEL GIT_COMMIT=$(git show-ref --heads | cut -f1 -d' ')" >> Dockerfile
  - echo "LABEL TAG_VERSION=$TAG_VERSION" >> Dockerfile
  - docker build --pull=true -t $IMAGENAME:$TAG_VERSION .
  - docker tag --force=true $IMAGENAME:$TAG_VERSION $IMAGENAME:$TAG_LATEST
  - docker push $IMAGENAME:$TAG_VERSION
  - docker push $IMAGENAME:$TAG_LATEST

notifications:
  slack: blackwoodseven:YYkUF4AOl26pZkxo2pTSbfxf