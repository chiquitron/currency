sudo: required

services:
   - docker	
   
env:
  global:
    - REGISTRY: registry.blackwoodseven.com
    - IMAGENAME: $REGISTRY/$TRAVIS_REPO_SLUG
    - TAG_VERSION: $TRAVIS_BRANCH.$TRAVIS_BUILD_NUMBER
    - TAG_LATEST: latest

before_script:
  - sudo curl -L https://github.com/docker/machine/releases/download/v0.5.3/docker-machine_linux-amd64 >/usr/local/bin/docker-machine
  - sudo chmod +x /usr/local/bin/docker-machine
  - docker-machine -v
  - docker-machine ls
  - docker-machine create --driver virtualbox dev
  - docker-machine ls
  - echo $DOCKER_HOST
  - echo $DOCKER_CERT_PATH
script:
  - docker build --pull=true -t $IMAGENAME:$TAG_VERSION .
  - docker tag --force=true $IMAGENAME:$TAG_VERSION $IMAGENAME:$TAG_LATEST
  - docker push $IMAGENAME:$TAG_VERSION
  - docker push $IMAGENAME:$TAG_LATEST